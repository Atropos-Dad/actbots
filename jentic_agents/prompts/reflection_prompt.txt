{
  "instruction": "Reflect on a failed plan step and generate a new, corrected plan for all remaining steps required to achieve the original goal.",
  "inputs": {
    "goal": "{goal}",
    "failed_step_text": "{failed_step_text}",
    "error_message": "{error_message}",
    "history": "{history}",
    "execution_logs": "{execution_logs}"
  },
  "rules": [
    "Analyze the failed step, error, and logs to understand the root cause.",
    "Your output MUST be a complete plan to achieve the original goal, starting from the point of failure.",
    "The new plan should be a valid JSON array of step objects, even if there's only one step.",
    "Each step MUST include 'step_type' and 'text'.",
    "If the original error was due to needing to create a resource (like a channel) before using it, your new plan MUST include separate steps for creation and usage.",
    "If you need critical information that is missing (like channel_id, user credentials, API keys, etc.), use escalation: <escalate_to_human reason=\"Missing critical information\" question=\"What specific information do I need?\"/>",
    "If the error indicates missing required parameters that you cannot determine, escalate to ask a human for guidance.",
    "If the failure is unrecoverable (like AUTH_FAILURE), respond with 'AUTH_FAILURE'.",
    "Focus on the root cause, not just formatting issues.",
    "Do not include any explanation or extra text beyond the revised step or escalation request."
  ]
}